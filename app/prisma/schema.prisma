// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
		provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
	id				Int			@id @default(autoincrement())
	
	code2FA			String
	auth2FA			Boolean		@default(false) 

	socketId		String		 

	nickname		String		@unique
	login_42		String		@unique

	email_42		String
	img_str			String		@default("default_user.png")

	elo				Int			@default(500)

	status			String		@default("online")						// offline / online / inGame

	wins			matches[]	@relation("wins")
	loses			matches[]	@relation("loses")


	friend1			Friends[]	@relation("friend1")
	friend2			Friends[]	@relation("friend2")

	player1			gameRooms[]	@relation("player1")
	player2			gameRooms[]	@relation("player2")
	// socket_id		Int

	channelRol		String		@default("user")						// owner / admin / user
	webRol			String		@default("user")						// owner / moderator / user
	expelled		Boolean		@default(false)
}

model Friends {
	id					Int			@id @default(autoincrement())

	friendUser1			User   		@relation("friend1", fields: [idUser1], references: [id])
	friendUser2			User   		@relation("friend2", fields: [idUser2], references: [id])

	idUser1				Int
	idUser2				Int
}

model JoinedChannels {
	id					Int			@id @default(autoincrement())
	idUser				String		@unique
	idChannel			String
}

model Channel {
	id					Int			@id @default(autoincrement())
	Name				String		@unique
	Password			Bytes
	isPrivate			Boolean		 @default(false)
}






model UserMutedChannel {
	id					Int			@id @default(autoincrement())
	idUser				String
	idChannel			String
	dateAllowedIn		DateTime
}

model UsersBannedChannel {
	id					Int			@id @default(autoincrement())
	idUser				String
	idChannel			String
}

model BlockedUsers {
	id					Int			@id @default(autoincrement())
	userBlocker			String
	userBlocked			String
}









model gameRooms {
	id					Int			@id @default(autoincrement())
	playerLeft			User		@relation("player1", fields: [idPlayerLeft], references: [id])
	playerRight			User		@relation("player2", fields: [idPlayerRight], references: [id])

	idPlayerLeft		Int
	idPlayerRight		Int

	waiting				Boolean
	findingMatch		Boolean

	modoDeJuego			String		@default("normal") //normal, wall
	ranked				Boolean
}

model viewers {
	id					Int			@id @default(autoincrement())
	idUserWatching		String
	idGameRoom			Int
}

model matches {
	id					Int			@id @default(autoincrement())
	userWon				User   		@relation("wins", fields: [idUsuarioVictoria], references: [id])
	userLost			User   		@relation("loses", fields: [idUsuarioDerrota], references: [id])

	idUsuarioVictoria	Int
	idUsuarioDerrota	Int
	modoDeJuego			String		@default("normal") //normal, pared
	ranked				Boolean
}